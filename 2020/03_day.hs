import qualified Data.Vector.Unboxed as V

data Grid = Grid { rows :: Int
                 , cols :: Int
                 , grid :: V.Vector Char }

type Step = (Int, Int)
type Position = (Int, Int)

input :: Grid
input = Grid 323 31 (V.fromList "........#.............#...........#....#...#....#..............#..#...#............#.....#..#..#......#..##............###............#......#..#..#........#..#.......#.........#.#...............#..#....##..#.##....#...#....##...#..................##..........#.##...#....##..#.....#....#...#..............#..............................#..#..##.##.#..................#......#.##..#............#................#.......#...#.....##.#..##..........#......#.......#.....#..........#...#..#.......#.......#...#...#.##.......#.#...........#...#...#...##.........#..............#.#....#.......#..#..#..#.#....#....................#........#...#..........#.##......#...#..#.##.......#......#.#.....#.#.............#.#.##..#..##......##...#.............#......#........#.....#...........#.......#....#.#...#.........#........#...........#...#.........#.#...........###....#.....#...........##....##........#....#..####....#.....#..#....#..........#...........#...........#.......#....#.#.........#......#...#.......#..###...............#......#..#......#..#.......#.....#............#..#........#.#.#.#..#.......#.....#....#....##...#.........#...##.....#..#.......#..#..#..#...##.....#.......#............#.....#....#........##....##...#........#.....#...#............................#........#...................#............#.#.#...#.#.......##..#.............#.........#.##..#........#..#...#...............#.#....#...........#...#.....#..#....#.....#...#.........#.#................#......................##......#...#....##...#...#.......##.#....#................#........#.......#.......##.#.#....................#.#..............#.......#....#.....#...#.......#..#...#..................#....#..#......#..........#...##................#.......#...#..#..##..............#..#...##...#..#.#.....#...#..#.#...#.........#.#..............###....#.......#...#................#......##.#...#..##..#......................#.#....................#...........#...#.#..#..#.....#.#...#...............#....#.....#...........#......##.....##...#......#..##.....#.....#.....###.#.....#....##...#...........###.................................#..##.#...#..................#....##.#.......#.#.#...#....#.........#..#.#.#.......#........##...................##.#....#.#............#..........#..##.#....#.................##..#....#......................#....#...........##...#.........#.#..#..#..........#......#........#......#.............#.#.#...............#.......#..#..##...#.##..........#......#....................#.#..............#....#...........#.#.#........#....##.##...............#.....#.......#..#......#....#..........#.#.....#.#....#............##.#.....#..#.....#.#.....................#...#....#.#............#..#....#...#...#................#.#.........#.......#..#..#.#..##..##............#...........................#..#.......#...........#....#.#.#......#..#...#........#...##............#......#.#.......#...#...#..##................#...................#.#..##....#.#...................#..#......#......#......#.#.#....#........#............#..#.##..#..#.........#...#....#.#...#..#.......#..#....#...##.........#..#...#.........#...........#.............#.....#.....................#.........#..#...............#.#...#....#..........#........#........#....#........##..##............#....#..#.#.......#...#.......#........#....#...##....#.#...#...#........##.....#....###..#....#....##......#........#............#..#.#..........#....#....#...#.....#.......##.....................#..........#.##..#...#..#..............#......#..................#......##....#..#..##..#.......#..#.#......#..............#........#.....#.#.#.##............#..#............#...#...........#..##.........#....#...#....#.......#..........#.#..#..#..#....#.....#..#......#..##..............#...#...#..........###......###.........##.##......#..#............#...#...........#.#.....#...#.....#.#..#...#............#.................#...#...#..........##........###..#..........#..................###.....#........#...#.............#.....#......#.....#.....#....#.#.........##.......##..##...#.......##..............#....##.........#......#...........#.....##..#.....#..#...........####...#..#.........#.##....#..#.#...#.......#.........#.#.##.#.#...#....#.#.#..............#...##........##.....#..#........#..........##...##.###...##..........#.#.........................#......#.................#.....#.#.......#.......#...#.....#....#.#..#..............#....................##.......#..................#.#...##.....#............#..##........#..........#....#.#.......##.#.....#..#.....................#.#..#....##.....#.................#...#..#..##....#.#.................#......#.#.......#.....#...#.#.......#...#.##..............#..........#....#.#.#.............#..#..........#..##.....#......#......#...#......#...#.###..#....##......##........#...#..........#.....#.......#.#.........#.....#.....#.#...........#...#....#.................................#.##..............#...#.......#.##...#.#.......#.......#......................#....#.#...#.#........#..........#......#....#...#.............#.......#...###.....#.#.#..#...#....##.#...............##.......#.......#..................#......####...............#.......##......#......#.#.......##.#.#......##..###....#....#......#.##.......##.##...#.##...............##............#.......#........#..#.....##.#.............#..........#.....##...........#.........#......#......##.#............#.......#..#......#.#..........#.......#...........#..#..##.#..................##................#.............#........##........#......##...##....#..#.#.....#..#....#..............#....#.....#.....#........#......##.....#....#....#......#.................#..#.#......#.......#..#......#....#.#...#.#....#.........#..#..........#.###......#............#...#...#.....##......#...#.....#....##...#...##.........#....................#.....................#....#..........###....#..........#....#...#..#.............#....#........#.#......#....#........#...#.......#..#...#.#...#..#.................##.#.....#.....###.......#...#...................#.......#...#.#.....#.........#.........#.....#.#.......#........#.......................##.....#.#..#....#.......#.........#....#..#....####........................#.....#...##.............#.........#...#..#.......##..#.........#....#.#............##...#.#...........#....#...........................##......###.......##....#.#.........#.#....#.#.#...........##....#........#...#..#..#..#..#.......#..#....#.#.......#..#..#..#...#.....##...#.##....#.#...#...............#..#....#..#...........##..##.........#.#.....#................#...##...#.#...#.....#.##..#..#.............#..........#...........#.......#......#.......#....#....#...##.......#..#.##........###..#......#.......#...........###......#..#..#.#.........#.#.........#.#.....##.......##.##.##......##..................#...#..........#.......................#.............#..#...........#...#...#.....................#...#......###...#................#.#.##....................#........#......#.............##......#.#..#.....#.#.....#..#.##.....##...#.........#.........#......#.......#.......#......#....#........#..#..##.....#.........#.............##.##.#...#.........##.#..................#..#..#..##......#..#...............###.........##............##.............................#...##...#...#.#..#.#......#.#..#.............##.#..#..##.........#.#.#...#.......##.#....................##..........#..#.....#.....#..#..#....#......#......#.##....#............###..#.............#..###................#.........#..#.....#.......#....#.............#.......#..#........#....#.....#.#.##..#.#...##........#.##...#..........#............#..............#...............##.............###........#.#............###..#.............#......##.............#...#.....#..........#......#....#........#.#..............#..#..............#.................#...........###........#.........###.....#.....#.#..............##......#.#..#...........#.........#..##..#................................#.....#..#....#....#......#....#...#......#.#..#....#.......#......#.##.......#......#............#..###..#................#..#.....#........##...#.............##.........##....#...##...#..........#.................##..#.......#...............#............#..###....#.#.##.#......#...#.##..##...............##.........#......................#....##...#......#....#...................#..........#..#.......#......##....#....#........#.#...................#.........#.#........###....#..........#..........#....#....#........##..#....#..#.........#..#.......................#..#...#..#...##.........#....##....#......#....#................................#........#...#.#...#.#..#........#..##...#.#...............#.....#....#.........#.........#...#...........##.........#.....##........#.#...#...#......#............#.....#...#.#.............###....#.....#.................##...#..........#....#.#........##..##..........#...........#............#..#....##......##...................#.#........#.#..#.#.....................#..##..#............##.###..#.#.#...#....#.#..........#.#............#....#.....#.............##....#...#.......#.....................##.##....#...............#............#...................#.............#....#.....................#......#............##.......#....#..##...#...#..#....#........................#.#.#...#......##...........##........##.#....#....#..............#.....#..#..#...#.##....#..........#....#.#..#..#..#......##..............#....................#.....#.#....#.......#.........#....##..#..##..#..........#......................#.....###...#..#......#...............#.....................#.....................................#.....###.......#..#....#....#..........#.................#.......#.......###.......#..##...............#.##....................#..#.#..#...........#.......#....##.#...#..#.#...#....#...................#...#....#.##......#.#....#.......................#.#.....#.....#..##......#..##...........#..#.....#.##..")

charAt :: Grid -> Position -> Char
charAt g (row, col') = let col   = col' `mod` (cols g)
                           index = row * (cols g) + col
                       in (grid g) V.! index

walk :: Grid -> Position -> Int -> Step -> Int
walk g (row, col) treeCount (right, down)
    | row >= (rows g) = treeCount
    | otherwise       = walk g (row + down, col + right) treeCount' (right, down)
    where treeCount' = treeCount + (if '#' == charAt g (row, col) then 1 else 0)

solvePart1 :: Int
solvePart1 = walk input (0, 0) 0 (3, 1)

solvePart2 :: Int
solvePart2 = let steps = [(1, 1), (3, 1), (5, 1), (7, 1), (1, 2)]
             in product $ map (walk input (0, 0) 0) steps